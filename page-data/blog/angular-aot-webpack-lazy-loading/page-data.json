{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/angular-aot-webpack-lazy-loading","result":{"data":{"markdownRemark":{"html":"<p><strong>@update: Updated the <a href=\"https://github.com/daniele-zurico/webpack-aot\">repo</a> with webpack 2.2 angular 2.4.3 and ngtools 1.2.3</strong></p>\n<p>Most of you have already heard about 'AOT and lazy loading' and you're struggling, without success, to setup it. I’ll show you how to configure it and, if you’re really curious or you’re learning angular2, some technical details about AOT (at least you read the article top-bottom).</p>\n<p>However, before going in depth, I want to share with you a screenshot</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/daniele-zurico.github.io/static/cc15488a0f2ac24c0d54338b8d780490/7e509/JIT.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.57142857142857%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABcUlEQVQoz32QwXabMBBF+f8faZfdxm1Pljltsm1qhwaDjQFhCQQGbCHgdky76KqLKz2dkfTeTNC7me42/QfP/U5ZtRTacrYd+bmm6R2m6VfutaysOJxKgp9xQX0F089Uwz/8PZthWesH1ZAI+7wmPChi0apxbBNFlBm2+oZuRwJra1hmZj/iR/cHd8NPHu9FXwfmacTWNfe7lTGkaYpSir7vVl2qgh+6Zeh6AqVKCsGYivHmcH7CzQtOimMUMe62jEBd2xVrG6I44S18p20vqPK8mhRNx7GSD8NfEe3lQj96nDx01jLGe1z4JrrB5Tk+jtFioKuasxgfjymnLGO4XmXPKYucXGa5iRuCTNK5YQCJPb18xx8TJmnPLxPz4pGVJTswvHyj0ZpKWi0kVSZGVswvEsaI0W2QjoRg9/RE8vUL4eMj2ccPJNGeJDuRxJrX14bd1rJ7H0g/bbCfN+iHB9LnZ/bpSWan0GJSlveRmTX9bzphD5DpCJGWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"JIT compilation\"\n        title=\"JIT compilation\"\n        src=\"/daniele-zurico.github.io/static/cc15488a0f2ac24c0d54338b8d780490/8c557/JIT.png\"\n        srcset=\"/daniele-zurico.github.io/static/cc15488a0f2ac24c0d54338b8d780490/4edbd/JIT.png 175w,\n/daniele-zurico.github.io/static/cc15488a0f2ac24c0d54338b8d780490/13ae7/JIT.png 350w,\n/daniele-zurico.github.io/static/cc15488a0f2ac24c0d54338b8d780490/8c557/JIT.png 700w,\n/daniele-zurico.github.io/static/cc15488a0f2ac24c0d54338b8d780490/7e509/JIT.png 745w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span> JIT compilation</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/daniele-zurico.github.io/static/dbb4003ad7326776a29edb701dde52d4/62de4/AOT.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.142857142857142%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTUlEQVQY01WQy27bMBBF9f+fEKCLoF/QoMmqAfoBLZJ20cYv2bAeJvWiJFoWKVk+HQnJogQugRnOHN6ZYBMXhKolO99Q7RVtp/815+a3ZmSbmKU2PNVskmqpX8cle4nflOVYOoKiKJjlvWccB8bhQ+/xdGV0PV5ydV3TiKqqYrsLsdZKbyk5Q9G0uMuFII0TDseIrusYpGkGe+fw41UgI0McMf5+xZ1SdFlR5AVaZ+zCPa0AT0qjRHlliExHoJRCSUF36ReAm4GAFyd+vcJpLZ8M9IcD5u8fMsmrLGe1WlM3DcYY6deL8+/RmWC2beqGm4woFmGauG03cNhLPKPnMy23T2WSX69YASV5KSto6PseJxN13YWrmAmO6Yns5QX98IXo6ZH86wPp8zcScZ7KssPdWdiWMDwTJ5b+0x3u8z3dzx+0sjPbtrTvauSjf0s8xHNe9NFGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AOT Compilation\"\n        title=\"AOT Compilation\"\n        src=\"/daniele-zurico.github.io/static/dbb4003ad7326776a29edb701dde52d4/8c557/AOT.png\"\n        srcset=\"/daniele-zurico.github.io/static/dbb4003ad7326776a29edb701dde52d4/4edbd/AOT.png 175w,\n/daniele-zurico.github.io/static/dbb4003ad7326776a29edb701dde52d4/13ae7/AOT.png 350w,\n/daniele-zurico.github.io/static/dbb4003ad7326776a29edb701dde52d4/8c557/AOT.png 700w,\n/daniele-zurico.github.io/static/dbb4003ad7326776a29edb701dde52d4/62de4/AOT.png 746w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span> AOT Compilation</p>\n<p>You impressed right? Ok let's start with the <strong>package.json:</strong></p>\n<p>[gist id =\"8c06bd89bc9eecc93bcf44bdcc610cf8\"]</p>\n<p>nothing special here apart  line 22: \"@ngTools/webpack\". This is THE webpack plugin that allows us to compile in AOT mode with webpack.</p>\n<p>The second step is the creation of <strong>webpack.config.js</strong>:</p>\n<p>[gist id =\"4f787b7d7b675574a5e009678aad1b43\"]</p>\n<p>The most important lines are:</p>\n<ul>\n<li>Line 1 where we define the <strong>@ngtools/webpack</strong>;</li>\n<li>Line 16 where we use it defining the tsconfig to use;</li>\n<li>Line 41 where we define the loader</li>\n</ul>\n<p>The last configuration file is the <strong>tsconfig.json</strong> file:</p>\n<p>[gist id =\"4adefb2cbaa822c12b5b69254019f94c\"]</p>\n<p>It's a normal tsconfig file, however the real differences are:</p>\n<ul>\n<li>line 4 where we define <strong>moduleResolution: node</strong></li>\n<li>line 21 where we define the **entryModule **</li>\n</ul>\n<p>Let's write some code now. Firstly we need the main module <strong>main.aot.ts</strong>, called <em>entryModule</em> in the tsconfig.json (line 21) and <em>entry</em> in package.json (line 9).</p>\n<p>[gist id =\"c44aa749a8e1ffb6ed79f5b746dc5e84\"]</p>\n<p>Don't worry if your IDE complains because this file does not exist (it's magic.. :) ) everything is in memory.</p>\n<p>Last but not least step is the router with the lazy loading support <strong>app.module.ts</strong>:</p>\n<p>[gist id =\"e6816cfafa5a2bc827fc47724cc7d937\"]</p>\n<p>Line 21 is the best line of ever (all the time I see it I feel so excited....you don't imagine for how long angular struggle to support this feature).</p>\n<p>It allows to load the module in lazy load mode or in other words only when it's requested (i.e. the user clicks on a link).</p>\n<p>And we done. Whaaaat? Really? Yes we did, I never  said that you've to be a 007 golden-eye. <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 260px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.85714285714286%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZUlEQVQoz43TTygEYRzG8R27TnLbmYul5CQ3SqucSIqm5CTuLv7kb4q2lFUcHIgTJ0mUA+KiSDmIHJbi4sKBnNyc+T7bb7Y3lkx9et5533ff+b0z78aCIIj9xvf9P/uitpvuYIKsIFvJTdRiEENQ3wYaMIkZLDC3k0yRZVosv6A1ShmYRgu20IwerCGLc8zjFNf2wBy/W7cHLyKpwtzt1KCSSWPkLrqxrEXpmyP3rLJjq/YAE9qV7ezHlpVN8FGNOmhLVYy1kyNIG1Wfpj9DhmQ/yt0ta7FtvOAQbXjEHaYYvyffyHeyD0c4wahVmbUiCgumuHlFI66sPYtxXNgDV7FD+5L8REexExA1tPqzvQ99gA8MoJexM50APHDfhX19YVskjoTx3Heor3xrk3NYYVBf84ZUpSGevp1Lz70vXBqwznodByaFNjFDLtnDdJyGbZ6qKYnefb4q97JO75//CK/YHPf6Ar7ncT86xVdZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"007\"\n        title=\"007\"\n        src=\"/daniele-zurico.github.io/static/aeed4de75aaefb7f951028334bcec24c/86c28/007.png\"\n        srcset=\"/daniele-zurico.github.io/static/aeed4de75aaefb7f951028334bcec24c/4edbd/007.png 175w,\n/daniele-zurico.github.io/static/aeed4de75aaefb7f951028334bcec24c/86c28/007.png 260w\"\n        sizes=\"(max-width: 260px) 100vw, 260px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> If you want the entire example as you (like me ;) ) are too lazy ... <a href=\"https://github.com/daniele-zurico/webpack-aot\">Enjoy it</a>... it contains all you need!</p>\n<p>Unfortunately, (yes in our world there's always an 'unfortunately') there're 3 things that you need to know:</p>\n<ul>\n<li>ngc (the compiler for AOT) is really strict so you'll probably have errors that you didn't get in the JIT.</li>\n<li>AOT compilation will fails if your application uses external packages not AOT complaints (help the community and don't be lazy. Fork the packages and create a PR).</li>\n<li>Making your Angular 2 library statically analyzable for AoT. <a href=\"https://medium.com/@isaacplmann/making-your-angular-2-library-statically-analyzable-for-aot-e1c6f3ebedd5#.cc70t7wyx\">Here</a> a good post that explain some best practice.</li>\n</ul>\n<p>Now there're two options! Either you're already working on your project or you really want to know more about AOT.</p>\n<h2>AOT vs JIT</h2>\n<p>I honestly don't want to copy paste from other blog so I'll give you same base information and then I'll share same useful links.The difference between AoT and JiT is a matter of timing and tooling.</p>\n<p>With AoT, the compiler runs once at build time using one set of libraries; With JiT it runs every time for every user at runtime using a different set of libraries.</p>\n<p>Just-in-time (JIT) compilation, also known as dynamic translation, is compilation done during execution of a program – at run time... When the user opens the browser, the following steps are performed:</p>\n<ol>\n<li>Download all the JavaScript assets;</li>\n<li>Angular bootstraps;</li>\n<li>Angular goes through the JiT compilation process <strong>generating all the JavaScript</strong>for each component in the application;</li>\n<li>The application gets rendered.</li>\n</ol>\n<p>In the Ahead of Time compilation(AOT) we prepare everything before and we don’t need anymore to dynamically compile the template. The benefit of course are really a lot:</p>\n<ul>\n<li>Faster rendering - the browser downloads a pre-compiled version of the application. The browser loads executable code so it can render the application immediately, without waiting to compile the app first;</li>\n<li>Fewer asynchronous requests - The compiler inlines external html templates and css style sheets within the application JavaScript, eliminating separate ajax requests for those source files;</li>\n<li>Smaller Angular framework download size - There's no need to download the Angular compiler if the app is already compiled. The compiler is roughly half of Angular itself, so omitting it dramatically reduces the application payload. Detect template errors earlier</li>\n<li>Better security - AoT compiles HTML templates and components into JavaScript files long before they are served to the client. With no templates to read and no risky client-side HTML or JavaScript evaluation, there are fewer opportunities for injection attacks.</li>\n</ul>\n<p>AoT compilation sets the stage for further optimizations through a process called <em>Tree Shaking</em>. A Tree Shaker walks the dependency graph, top to bottom, and shakes out unused code like dead needles in a Christmas tree.</p>\n<h2>Summary</h2>\n<p>Well I think that now you have a good overview of what is AOT and why is so amazing and before finishing with this article I want to say a special thanks to <strong>Rob Wormald,</strong> who helped me in the configuration, **Olivier Combe, **to review my first post, and share with you some links:</p>\n<ol>\n<li>The angular2 documentation <a href=\"https://angular.io/docs/ts/latest/cookbook/aot-compiler.html\">https://angular.io/docs/ts/latest/cookbook/aot-compiler.html</a> ( from where I copied some parts)</li>\n<li>an Interesting talk of Tobias Bosh (the father of the compiler) <a href=\"https://www.youtube.com/watch?v=kW9cJsvcsGo\">https://www.youtube.com/watch?v=kW9cJsvcsGo</a> during angular connect</li>\n<li>Same slide of Wassim Chegham - <a href=\"http://slides.com/wassimchegham/demystifying-ahead-of-time-compilation-in-angular-2-aot-jit\">http://slides.com/wassimchegham/demystifying-ahead-of-time-compilation-in-angular-2-aot-jit</a></li>\n</ol>\n<p>And well... follow me on twitter (<a href=\"https://twitter.com/dzurico\">https://twitter.com/dzurico</a>) ;)</p>","frontmatter":{"date":"December 04, 2016","path":"/blog/angular-aot-webpack-lazy-loading","title":"Angular2 AOT with Webpack and Lazy Loading","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAA//aAAwDAQACEAMQAAAB5jrtacxMH//EABoQAQADAAMAAAAAAAAAAAAAAAIAAREDBBL/2gAIAQEAAQUC8rSHcuddox8r3bn/xAAWEQEBAQAAAAAAAAAAAAAAAAAAERL/2gAIAQMBAT8BjL//xAAXEQEAAwAAAAAAAAAAAAAAAAAAARIT/9oACAECAQE/AbS0f//EABkQAAMAAwAAAAAAAAAAAAAAAAABERASQf/aAAgBAQAGPwJjODjLtj//xAAaEAADAQEBAQAAAAAAAAAAAAAAARExUWGR/9oACAEBAAE/IXsNtPpirOoq58ClZXTQLD2Z/9oADAMBAAIAAwAAABBgP//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAwEBPxBO4w7/xAAXEQADAQAAAAAAAAAAAAAAAAAAARFR/9oACAECAQE/EFConD//xAAaEAEBAQEAAwAAAAAAAAAAAAABEQAhYZHB/9oACAEBAAE/EDgIBS80DhrL7pjtS8xQRngO4Ma0XxocPdv/2Q==","aspectRatio":1.7857142857142858,"src":"/daniele-zurico.github.io/static/36157b023b0cc73b66f2bc6ca8a6ba36/14b42/angular2-compiler.jpg","srcSet":"/daniele-zurico.github.io/static/36157b023b0cc73b66f2bc6ca8a6ba36/f836f/angular2-compiler.jpg 200w,\n/daniele-zurico.github.io/static/36157b023b0cc73b66f2bc6ca8a6ba36/2244e/angular2-compiler.jpg 400w,\n/daniele-zurico.github.io/static/36157b023b0cc73b66f2bc6ca8a6ba36/14b42/angular2-compiler.jpg 800w,\n/daniele-zurico.github.io/static/36157b023b0cc73b66f2bc6ca8a6ba36/47498/angular2-compiler.jpg 1200w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{}},"staticQueryHashes":["1135375505","1135375505","3206378567"]}