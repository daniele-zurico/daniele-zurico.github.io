{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/modularise-our-apollo-server-schema","result":{"data":{"markdownRemark":{"html":"<p>When our schema starts to become long and complex one of the technique we have is schema stitching. Apollo team is working really hard to provide a better way to split our schema into multiple files introducing <em>Modules</em>.</p>\n<h2>Modules</h2>\n<p>The better way to describe how modules work is giving a small example and explain step by step what to do to implement it.\nLet try to build a query that displays a list of books with author and a list of Authors:</p>\n<pre><code>type Book {\n  title: String\n  author: Author\n}\n type Author {\n  name: String\n  books: [Book]\n}\n</code></pre>\n<p>As usual we start from our <code>index.js</code>:</p>\n<pre><code>const {ApolloServer} = require('apollo-server');\n const server = new ApolloServer({\n    modules: [\n        require('./modules/author'),\n        require('./modules/books')\n    ]\n})\n server\n    .listen()\n    .then(({url}) => console.log(`server is running at ${url}`));\n</code></pre>\n<p>As we can see the main change is the <em>modules</em> array that includes 2 requires: <em>author</em> and <em>books</em>.</p>\n<p>Let's create our <code>./modules/author/index.js</code>:</p>\n<pre><code>const {gql} = require('apollo-server');\n const typeDefs = gql`\n    extend type Query {\n        author(id: ID!): Author\n        authors: [Author]\n    }\n     type Author {\n        id: ID!\n        name: String\n        surname: String\n    }\n`;\n const resolvers = {\n    Query: {\n        author(_, {id}) {\n            return {\n                id,\n                name: 'Daniele',\n                surname: 'Zurico'\n            }\n        },\n        authors() {\n            return [\n                {\n                    id: Math.round(Math.random() * 100000),\n                    name: 'Daniele',\n                    surname: 'Zurico',\n                },\n                {\n                    id: Math.round(Math.random() * 100000),\n                    name: 'Alex',\n                    surname: 'Michaels',\n                }\n            ]\n        }\n    }\n};\n module.exports = {\n    typeDefs,\n    resolvers\n}\n</code></pre>\n<p>Our author file has no difference with what we already learnt. We created 2 queries:</p>\n<ul>\n<li>list of authors;</li>\n<li>The author has given the id.</li>\n</ul>\n<p>Is time to move to <code>./modules/books/index.js</code>:</p>\n<pre><code>const {gql} = require('apollo-server');\n const typeDefs = gql`\n    extend type Query {\n        book(id: ID!): Book\n        books: [Book]\n    }\n     type Book {\n        id: ID!\n        title: String\n        author: Author\n    }\n     extend type Author {\n        books: [Book]\n    }\n`;\n const resolvers = {\n    Query: {\n        book(_, {id}) {\n            return {\n                id,\n                title: 'test',\n                author: {\n                        id: Math.round(Math.random() * 100000),\n                        name: 'Daniele',\n                        surname: 'Zurico'\n                    }\n            }\n        },\n        books() {\n            return [\n                {\n                    id: Math.round(Math.random() * 100000),\n                    title: 'test',\n                    author:{\n                        id: Math.round(Math.random() * 100000),\n                        name: 'Daniele',\n                        surname: 'Zurico'\n                    }\n                },\n                {\n                    id: Math.round(Math.random() * 100000),\n                    title: 'test2',\n                    author: {\n                        id: Math.round(Math.random() * 100000),\n                        name: 'Alex',\n                        surname: 'Michaels'\n                    },\n                }\n            ]\n        }\n    },\n    Author: {\n        books() {\n            return [{\n                id: Math.round(Math.random() * 100000),\n                title: 'test',\n            }]\n        }\n    }\n };\n module.exports = {\n    typeDefs,\n    resolvers\n}\n</code></pre>\n<p>Our books contain something more then we probably didn't see before:</p>\n<pre><code>extend type Author {\n  posts: [Book]\n}\n</code></pre>\n<p>And this is the glue between our Author and Books that allow us to extend the Author schema introducing the list of Books.</p>\n<h2>Test our Server</h2>\n<p>To explore the newly created GraphQL API, open a browser to the link shown in the console, <code>http://localhost:4000/</code></p>\n<pre><code>query {\n  books {\n    id\n    title\n    author {\n      id\n      name\n        surname\n    }\n  }\n}\n</code></pre>\n<pre><code>query {\n  authors {\n    id\n    name\n    surname\n    books {\n      id\n      title\n    }\n  }\n}\n</code></pre>\n<h2>Conclusion</h2>\n<p>Modules currently lack support for some things, like custom scalars, but will work for some simple cases, and we plan on expanding the support.</p>","frontmatter":{"date":"July 08, 2019","path":"/blog/modularise-our-apollo-server-schema","title":"Modularise our Apollo Server schema","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAABQD/xAAUAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAFg5MhFyor/xAAZEAEBAAMBAAAAAAAAAAAAAAABAwACBBH/2gAIAQEAAQUCq+ErGzlAZ8+o3z//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwFn/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQEQ/9oACAECAQE/AYGf/8QAGxAAAQQDAAAAAAAAAAAAAAAAEQABECFBcbH/2gAIAQEABj8C6noC6zDlaj//xAAaEAACAgMAAAAAAAAAAAAAAAABESFRABAx/9oACAEBAAE/IU/VSsUQnBwlHQ1BxioRAMa//9oADAMBAAIAAwAAABDrz//EABYRAQEBAAAAAAAAAAAAAAAAABEBEP/aAAgBAwEBPxBMM//EABYRAQEBAAAAAAAAAAAAAAAAABEBEP/aAAgBAgEBPxCUc//EAB8QAQEAAAUFAAAAAAAAAAAAAAERABAhMUFRYYGxwf/aAAgBAQABPxB9SGqlGBUHx7xRZl2w9TdfplJAGmsiGCY2O4Gb98v/2Q==","aspectRatio":1.779935275080906,"src":"/static/76fff4f81045830296ebce9b67798d69/85590/apollo-module.jpg","srcSet":"/static/76fff4f81045830296ebce9b67798d69/d278e/apollo-module.jpg 200w,\n/static/76fff4f81045830296ebce9b67798d69/8539d/apollo-module.jpg 400w,\n/static/76fff4f81045830296ebce9b67798d69/85590/apollo-module.jpg 550w","sizes":"(max-width: 550px) 100vw, 550px"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}