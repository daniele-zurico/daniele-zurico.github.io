{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/apollo-server-2-0-real-time-data-with-subscriptions","result":{"data":{"markdownRemark":{"html":"<p>In the <a href=\"http://www.dzurico.com/apollo-server-2-0-auth-with-google-signin/\">previous post</a> we set up our server using google-sign-in as identity server and we restricted access to the authenticated users. Today we'll add real-time update thanks to <strong>GraphQL subscriptions</strong>. The scenario we'll implement is quite easy: we want to see in real-time when a new post is added to our list.</p>\n<p>The first thing to do is to define the schema of our database creating the file <strong>posts.ts</strong> with author and comment: [gist id=\"599f866262ac9cc7aa8babf39a1656bc\"]</p>\n<p>After that we need to create the GraphQL schema <strong>post.schema.ts</strong>: [gist id=\"5549040ef27e5ab7025cfdb9204739a4\"]</p>\n<p>We defined: - a query to retrieve all the posts (line <strong>11</strong>); - a mutation to store a new post (line <strong>14</strong>).</p>\n<p>The resolver that implements all the functionalities <strong>post.resolver.ts</strong>: [gist id=\"13a620013c546f38d0f8740b3ac9a173\"]</p>\n<p>The controller \"<strong>post.controller.ts</strong>\" that will interact with our mongoDb: [gist id=\"77030b30c751bea38e47a1c7cbb0dacc\"]</p>\n<p>Our setup is completed and it's time to add real-time data. Apollo Server 2.0 supports GraphQL subscriptions without additional configuration or packages.</p>\n<p>In the <strong>post.schema.ts</strong>: [gist id=\"d80dbdd04840ad9f6a2f5ded7025bb84\"] We added <strong>line 20-22</strong> where we expect to receive all the new posts that are added and the related controller <strong>post.controller.ts</strong> that will interact with our mongoDB: [gist id=\"efdb6c090ae8bf9073352f8424b5af86\"]</p>\n<p>We added: - <strong>line 19</strong> to publish the new change; - <strong>line 7-11</strong> to add the subscription.</p>\n<p>One small thing that makes me struggle quite a lot is the <strong>server.ts</strong>. In case you have defined a context remember to add: [gist id=\"ff53e986163a71b284efecf40db6800c\"]</p>\n<p>As you can see <strong>Apollo Server 2.0</strong> allows realtime data without invasive changes to existing code. For a full working example please have a look to <a href=\"https://github.com/daniele-zurico/apollo2-subscriptions-how-to\">this repo</a>.</p>\n<p>@Update I'm proud to say that I wrote as well the documentation for subscriptions in the official doc of apollo and the repo I've create is <a href=\"https://www.apollographql.com/docs/apollo-server/v2/features/subscriptions.html\">linked</a> there too!</p>\n<p>If you enjoyed this post follow me on twitter <a href=\"https://twitter.com/DZurico?lang=en\">@DZurico</a></p>","frontmatter":{"date":"June 16, 2018","path":"/blog/apollo-server-2-0-real-time-data-with-subscriptions","title":"Apollo server 2.0 - real time data with subscriptions","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUBAgME/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAAU89e1SqLk1//8QAGRAAAwEBAQAAAAAAAAAAAAAAAAECERID/9oACAEBAAEFAlLOTlnhOG6rjH//xAAWEQADAAAAAAAAAAAAAAAAAAABEBL/2gAIAQMBAT8BoL//xAAYEQACAwAAAAAAAAAAAAAAAAAAAQIRIf/aAAgBAgEBPwGOos//xAAaEAACAgMAAAAAAAAAAAAAAAAAEAERAjEy/9oACAEBAAY/AtWcqDK1/8QAHBAAAwACAwEAAAAAAAAAAAAAAAERMUEhcZHh/9oACAEBAAE/IVq/Iz+iWZ6Wtbvo4ZE1abGn/9oADAMBAAIAAwAAABD4L//EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQMBAT8QQ0Y7f//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQIBAT8QTZEn/8QAHBABAQADAQADAAAAAAAAAAAAAREAITFRQWGR/9oACAEBAAE/ELhGMNr+YiIOV+B94oiL4gwdiJNOjzCGBpea5gTNxam8/9k=","aspectRatio":1.5052192066805845,"src":"/daniele-zurico.github.io/static/99067c114b968f5d7fed772ce4ab2076/bebe7/apollo-stream.jpg","srcSet":"/daniele-zurico.github.io/static/99067c114b968f5d7fed772ce4ab2076/d278e/apollo-stream.jpg 200w,\n/daniele-zurico.github.io/static/99067c114b968f5d7fed772ce4ab2076/8539d/apollo-stream.jpg 400w,\n/daniele-zurico.github.io/static/99067c114b968f5d7fed772ce4ab2076/bebe7/apollo-stream.jpg 721w","sizes":"(max-width: 721px) 100vw, 721px"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}