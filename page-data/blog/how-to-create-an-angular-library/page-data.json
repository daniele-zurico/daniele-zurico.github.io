{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/how-to-create-an-angular-library","result":{"data":{"markdownRemark":{"html":"<p>In the <a href=\"http://www.dzurico.com/angular-aot-webpack-lazy-loading/\">first</a> post we built our application in AOT mode, now it's time to create a library that is AOT compliant.</p>\n<p>Most of you are thinking ...\"wait, is it not the same????\" No it's not, unfortunately it is not an easy job to find good resources and <a href=\"http://www.angular.io\">angular.io</a> doesn't help a lot for that.</p>\n<p>Don't worry we'll figure out how to do it. First things first, of course, we need to write our code... we’ll assume that we have an awesome library containing a component that displays 'HelloWorld' (it will be an useful library :) ).</p>\n<p>[caption id=\"attachment_7018\" align=\"aligncenter\" width=\"229\"]<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 608px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/daniele-zurico.github.io/static/3daf1f0f168edd6e1d6bc38a95644317/18872/Screen-Shot-2016-12-13-at-21.02.49.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwUlEQVQ4y4WTW4+bMBCF87PaTSCAwyUkgI2vGLra7Vatqqr9/2+nGhPSDUXtw8jCFsffmTne1U0H4SZ0QiJlOT7sI3w8xPd6io44HFPs4ySs/6vdqTyDKwvtP+HaCZTnC+qmRXVpUF9bsKK6i/6rlgt3UZIhyU7gZoDQDr1xsH6EsgOkceGSOGWbhLS31PK9WzaK6oyq4TDTC6x7RicUeK+ghxH1tdkUJBiqB8Ll8Ck+Yh8liLIM/KsB1xLKemjr0GuLXhl0vYIyDlKbsNcKFVZysbRl916d1iTNMBoOpTW0G2EcWbfoeolWyNAKEqd2NLwHlwrNWvAPZYI0ZXiTHv3NrnE+UBAZlzoI0QVCzZRCadBg/7I8Ex5xYAWKt18Q1gcx7ebhUD9JUNuZmMQuLQ+poHjdh7IWjFmO6+t3dMoGeyQgbv0ji+pG14o+/PNebIMwQcwY6s/fQozM4GEHopxJKU5mGAMtRWmdwU3LEStQv/5AS2G3LgyiqOoQDwp5lpdI2AnrYT4I3g8iEszRfvkJOUzw4wTrJ1yaDiwvESdZsLgO88PTW2NnRQUuLVreQ0gFbX1459RLVpQPz3Ar7L8B/2feHbaqbLIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"HelloWorld library\"\n        title=\"HelloWorld library\"\n        src=\"/daniele-zurico.github.io/static/3daf1f0f168edd6e1d6bc38a95644317/18872/Screen-Shot-2016-12-13-at-21.02.49.png\"\n        srcset=\"/daniele-zurico.github.io/static/3daf1f0f168edd6e1d6bc38a95644317/4edbd/Screen-Shot-2016-12-13-at-21.02.49.png 175w,\n/daniele-zurico.github.io/static/3daf1f0f168edd6e1d6bc38a95644317/13ae7/Screen-Shot-2016-12-13-at-21.02.49.png 350w,\n/daniele-zurico.github.io/static/3daf1f0f168edd6e1d6bc38a95644317/18872/Screen-Shot-2016-12-13-at-21.02.49.png 608w\"\n        sizes=\"(max-width: 608px) 100vw, 608px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span> HelloWorld library[/caption]</p>\n<p>Nothing special here, in our library we have:</p>\n<ol>\n<li>module - <em>HelloWorld.module.ts;</em></li>\n<li>component - <em>HelloWorld.component.ts;</em></li>\n<li>html - <em>HelloWorld.component.html</em>;</li>\n<li>scss - <em>HelloWorld.component.scss</em>  (that will be hard to manage...but we'll see later);</li>\n<li>test - <em>HelloWorld.spec.ts</em> ... writing the <strong>tests for your library is really important (vital)!!!</strong></li>\n</ol>\n<p>There's one file that requires more attention and it is the module.</p>\n<p>[gist id=\"1dbb39433d4d22483c524d18dc458b27\"]</p>\n<p>The most important lines are <strong>14</strong> and <strong>15</strong>.</p>\n<p>By convention, the <strong><em>forRoot</em></strong> static method both provides and configures services at the same time. It takes a service configuration object and returns a ModuleWithProviders which is a simple object with two properties:</p>\n<ul>\n<li><code>ngModule</code> - the <code>CoreModule</code> class</li>\n<li><code>providers</code> - the configured providers</li>\n</ul>\n<p>The root <code>AppModule</code> imports the <code>CoreModule</code> and adds the <code>providers</code> to the <code>AppModule</code> providers.</p>\n<p>Ok! We've our awesome component, now let's build our library by creating the dist that will be used by another application. Unfortunately tools like webpack or rollup are not very helpful for that because they create one output bundled file (and it is not what we want).</p>\n<p>In this case we've just one solution and actually it is the best one: the <strong>ngc</strong> compiler. The command is quite easy to use and it's:</p>\n<p><strong>ngc -p src/tsconfig.aot.json</strong></p>\n<p>The tsconfig file is:</p>\n<p>[gist id= \"6b48d403db7d6b0902c4de52acc5e073\"]</p>\n<p>Of course it is better to write this command in our <em>package.json</em>:</p>\n<p>[gist id =\"96353c03cd29d68101bea94e14840c64\"]</p>\n<p>As you can see on line 11 with the <em>build</em> command we run 3 commands in sequence:</p>\n<p>The first one deletes the dist folder, the second one compiles our source code and the last one is the tricky part. Ngc is unable to understand <em>scss</em> file so we have to manage it manually. We'll create a gulp file:</p>\n<p>[gist id =\"603882bc04eb2397eedb99b94854d950\"]</p>\n<p>this gulp performs a couple of tasks:</p>\n<ol>\n<li>copy all the html files;</li>\n<li>copy the assets;</li>\n<li>copy the scss.</li>\n</ol>\n<p>The most important part is line <strong>23</strong> that does the inline resource (from Angular Material2 repo):</p>\n<p>[gist id =\"a3df2069560447b0db70b188922a16ef\"]</p>\n<p>the output of the compiled component will be:</p>\n<p>[caption id=\"attachment_7019\" align=\"aligncenter\" width=\"422\"]<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/daniele-zurico.github.io/static/b0312b2141ff7e36f3187fd4e886ee1b/7e4a6/Screen-Shot-2016-12-13-at-21.40.43.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.142857142857146%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVQoz02P247TMBRF+zPTJrbjYztxmjidXpIpKaQVqIzESDzwAP//CwsZhmEels5FOnufvVqmyJe55zp1fP008PmSGPcdKT6yaw90zUCMW7Q2lGWJUhqlFDqj9RvqdV5Za+jaLDAwDIn5sjDPN47pxKEfSY+Jtm9xtcUF+yaUBd7zb7fKjtk587B+wGrHlC4c05m6aRhPgfk6cVomnm4fGOcT06Fh2wrGaExlMKb6/6FWGpNjlIo6eHYpcRyOxLAl1IHYeULj8I3/Q+xrQi3UrUNchXiLiLyLLAZlDarS+JiPPVoXrDcbNpv8dcF6XVAUJZsiz7kqiqKgKNXfPid8jb6azi3X+8Dl1rPcE0/nSNsIXXTse8+4C4xDwHthqA2nqEm1QUJD9JZjo9gGwXuPE8vq+yTcx8DL0vPrecfL0vHjvuPntz3PH7cMbRYXRCyNGFLQtE5TicNbQ+8VtatwIoit+A20x+COIjYfxgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"aot compiled component\"\n        title=\"aot compiled component\"\n        src=\"/daniele-zurico.github.io/static/b0312b2141ff7e36f3187fd4e886ee1b/8c557/Screen-Shot-2016-12-13-at-21.40.43.png\"\n        srcset=\"/daniele-zurico.github.io/static/b0312b2141ff7e36f3187fd4e886ee1b/4edbd/Screen-Shot-2016-12-13-at-21.40.43.png 175w,\n/daniele-zurico.github.io/static/b0312b2141ff7e36f3187fd4e886ee1b/13ae7/Screen-Shot-2016-12-13-at-21.40.43.png 350w,\n/daniele-zurico.github.io/static/b0312b2141ff7e36f3187fd4e886ee1b/8c557/Screen-Shot-2016-12-13-at-21.40.43.png 700w,\n/daniele-zurico.github.io/static/b0312b2141ff7e36f3187fd4e886ee1b/7e4a6/Screen-Shot-2016-12-13-at-21.40.43.png 952w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span> aot compiled component[/caption]</p>\n<p>As you can see the templateUrl and the StyleUrls have been replaced by their content.</p>\n<p>Well, we're done and the full example is available <a href=\"https://github.com/daniele-zurico/angular2-library\">here</a>! Technically there's a small caveat, the old deploy system like System.js etc requires an <em>umd</em> file. We can bundle our library in two possible ways:</p>\n<ol>\n<li>with webpack (have a look at my previous <a href=\"http://www.dzurico.com/angular-aot-webpack-lazy-loading/\">post</a>);</li>\n<li>with rollup.js - Larkin suggests to use rollup.js for libraries.</li>\n</ol>\n<p>[caption id=\"attachment_7042\" align=\"aligncenter\" width=\"465\"]<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/daniele-zurico.github.io/static/18fd08b7d510c6433367db56d1de0a22/04784/Screen-Shot-2016-12-13-at-23.10.19.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.285714285714285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAx0lEQVQY042P4U7CMBSF98AaHm4P4Q8NohIiiYpj7dqVCB0b4Nq1n1kn/vYkJ9/JzU3uuZlSitrs+Pjc/vFgj9j2RNOeOF++abozMZL0C8KVITKEQIwTs9ntDffLNQ/FnkWx4+5N81jueZaWuWh4qo4shOVFtax0y9p0yUvd8mo63g8O9WVxfZ8OZHmeUwqJ1Aapa8pKsSklqjYIbSikTnmzlcnjnlA1otKUlebS+9Qyhqlzdn3D+SENxtrO+ykPgd55/qvx7R/oQS9z2mOMvQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"rollup for library\"\n        title=\"rollup for library\"\n        src=\"/daniele-zurico.github.io/static/18fd08b7d510c6433367db56d1de0a22/8c557/Screen-Shot-2016-12-13-at-23.10.19.png\"\n        srcset=\"/daniele-zurico.github.io/static/18fd08b7d510c6433367db56d1de0a22/4edbd/Screen-Shot-2016-12-13-at-23.10.19.png 175w,\n/daniele-zurico.github.io/static/18fd08b7d510c6433367db56d1de0a22/13ae7/Screen-Shot-2016-12-13-at-23.10.19.png 350w,\n/daniele-zurico.github.io/static/18fd08b7d510c6433367db56d1de0a22/8c557/Screen-Shot-2016-12-13-at-23.10.19.png 700w,\n/daniele-zurico.github.io/static/18fd08b7d510c6433367db56d1de0a22/e996b/Screen-Shot-2016-12-13-at-23.10.19.png 1050w,\n/daniele-zurico.github.io/static/18fd08b7d510c6433367db56d1de0a22/04784/Screen-Shot-2016-12-13-at-23.10.19.png 1174w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span> rollup for library[/caption]</p>\n<p>The last little thing ( I promise it is the last one) is that in the github repo we have <em>webpack</em> for the tests (again ... keep in mind, tests are crucial).</p>\n<p>Now we're really done :)</p>\n<p>Special thanks as usual to <strong>Olivier Combe</strong> for the review and If you enjoyed the post follow me on twitter <a href=\"https://twitter.com/dzurico\">@DZurico</a></p>","frontmatter":{"date":"December 13, 2016","path":"/blog/how-to-create-an-angular-library","title":"How to create an Angular library","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgADBP/EABYBAQEBAAAAAAAAAAAAAAAAAAMAAf/aAAwDAQACEAMQAAAB50NjQRsv/8QAGRABAAMBAQAAAAAAAAAAAAAAAQACMREy/9oACAEBAAEFAoqwXlfblM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAACAwEAAAAAAAAAAAAAAAAAEAEhcYH/2gAIAQEABj8CLXSdX//EABwQAAICAgMAAAAAAAAAAAAAAAABETEQIVFx0f/aAAgBAQABPyFuXDIzhoc9F2P3dn//2gAMAwEAAgADAAAAEHPf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFREBAQAAAAAAAAAAAAAAAAAAAAH/2gAIAQIBAT8QV//EAB4QAQACAgEFAAAAAAAAAAAAAAEAESFBMVFxkaHB/9oACAEBAAE/ELs3Cc101BGlqDVQNV0YwIb7Ynij7PZz/9k=","aspectRatio":2,"src":"/daniele-zurico.github.io/static/85393881a37888f53334375bd4af3a6d/14b42/library-in-angular.jpg","srcSet":"/daniele-zurico.github.io/static/85393881a37888f53334375bd4af3a6d/f836f/library-in-angular.jpg 200w,\n/daniele-zurico.github.io/static/85393881a37888f53334375bd4af3a6d/2244e/library-in-angular.jpg 400w,\n/daniele-zurico.github.io/static/85393881a37888f53334375bd4af3a6d/14b42/library-in-angular.jpg 800w,\n/daniele-zurico.github.io/static/85393881a37888f53334375bd4af3a6d/a46db/library-in-angular.jpg 1190w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{}},"staticQueryHashes":["1135375505","3206378567"]}